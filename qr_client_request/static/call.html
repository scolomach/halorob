<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Call the robot</title>
<style>
  :root { --bg:#f6f7f9; --card:#fff; --muted:#6b7280; --ring:#2563eb; }
  * { box-sizing: border-box; }
  body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin:0; background:var(--bg); padding:24px; }
  .card { max-width: 560px; margin: 0 auto; background: var(--card); border-radius: 16px; padding: 24px;
          box-shadow: 0 10px 24px rgba(0,0,0,.06); }
  h1 { font-size: 1.5rem; margin: 0 0 8px; }
  .muted { color: var(--muted); margin:0 0 12px; }
  .row { display:flex; gap:12px; margin-top: 12px; }
  button { appearance: none; border: 0; border-radius: 12px; padding: 12px 16px; font-weight: 700; cursor: pointer; }
  .primary { background: var(--ring); color:#fff; }
  .ghost { background:#e5e7eb; color:#111827; }
  .badge { display:inline-block; padding:4px 10px; border-radius:999px; background:#eef2ff; color:#1e40af; font-weight:700; }
  pre { white-space: pre-wrap; font-family: ui-monospace, SFMono-Regular, Menlo, monospace; background:#f3f4f6;
        padding:12px; border-radius:12px; margin-top:12px; }
  .kv { margin: 4px 0; }
  .kv code { background:#f3f4f6; padding:2px 6px; border-radius:6px; }
</style>
</head>
<body>
  <div class="card">
    <h1>Call the robot</h1>
    <p class="muted" id="desc">Loading…</p>

    <div id="details"></div>

    <div class="row">
      <button class="primary" id="confirm">Request robot</button>
      <button class="ghost" id="cancel">Cancel</button>
    </div>

    <pre id="status"></pre>
  </div>

<script>
(()=> {
  const p = new URLSearchParams(location.search);
  const table = p.get('table');
  const name  = p.get('name');     // NEW: pass a human name
  const token = p.get('token') || 'demo-token';

  const desc   = document.getElementById('desc');
  const status = document.getElementById('status');
  const details= document.getElementById('details');
  const confirm= document.getElementById('confirm');
  const cancel = document.getElementById('cancel');

  // Basic validation
  if(!table || !token){
    desc.textContent = 'Missing parameters. URL must include ?table=...&token=...';
    confirm.disabled = true;
    return;
  }

  // UI preview
  desc.innerHTML = `Send the robot to <span class="badge">${table}</span>?`;
  details.innerHTML = name ? `<div class="kv">Customer: <code>${name}</code></div>` : '';

  cancel.onclick = () => {
    status.textContent = 'Canceled.';
    setTimeout(()=>history.back(), 600);
  };

  confirm.onclick = async () => {
    status.textContent = 'Sending request…';
    confirm.disabled = true;

    try {
      const payload = { token, table };
      if (name) payload.name = name; // include the name if present

      const r = await fetch('/go', {
        method: 'POST',
        headers: { 'Content-Type':'application/json' },
        body: JSON.stringify(payload)
      });

      const txt = await r.text();
      if (!r.ok) throw new Error(`HTTP ${r.status}: ${txt}`);
      status.textContent = `✔ OK:\n${txt}`;
    } catch (e) {
      status.textContent = `✖ Error: ${e.message}`;
      confirm.disabled = false;
    }
  };
})();
</script>
</body>
</html>
